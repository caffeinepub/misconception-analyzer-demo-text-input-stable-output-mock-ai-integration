{
  "kind": "build_request",
  "title": "Make analysis reflect arbitrary user explanations (misconception + mental-model breakdown)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the backend `analyzeExplanation` method (`backend/main.mo`) so it no longer returns fixed placeholder strings and instead produces a result derived from the caller-provided explanation text, returning exactly two fields: `misconception` and `whyFailed`, where `whyFailed` explains why the user’s mental model broke down.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5",
          "msg-7",
          "msg-9"
        ],
        "quotes": [
          "make it work: You enter your explanation → The system analyzes your thinking pattern → You receive insights about the specific misconception and why your mental model broke down.",
          "How it works: You enter your explanation → The system analyzes your thinking pattern → You receive insights about the specific misconception and why your mental model broke down.",
          "yes"
        ]
      },
      "acceptanceCriteria": [
        "Calling `analyzeExplanation` with two different non-empty inputs produces meaningfully different outputs (not static placeholders).",
        "Returned record has exactly the fields `misconception : Text` and `whyFailed : Text` (no additional fields).",
        "`whyFailed` explicitly describes the reasoning error/mental-model breakdown (not just that the answer is wrong).",
        "Backend output references the user’s actual input at least minimally (e.g., via a short quoted snippet or paraphrase) so it feels tied to arbitrary user-entered text."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure the frontend analysis flow reliably uses the backend result when the backend method exists, and only shows the fallback disclosure prefix (`[Using fallback analyzer]`) when the fallback analyzer was actually used (not when backend succeeds).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5",
          "msg-9"
        ],
        "quotes": [
          "make it work: You enter your explanation → The system analyzes your thinking pattern → You receive insights about the specific misconception and why your mental model broke down.",
          "yes"
        ]
      },
      "acceptanceCriteria": [
        "When backend `analyzeExplanation` succeeds, the UI displays `misconception` and `whyFailed` without any fallback disclosure prefix.",
        "When backend `analyzeExplanation` throws/fails, the UI still produces results and `whyFailed` begins with `[Using fallback analyzer]`.",
        "Submitting arbitrary (non-example) user text results in analysis that reflects that text (not outputs that appear tied only to built-in examples)."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under `frontend/src/components/ui` (compose existing components instead).",
    "Do not modify `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, or `frontend/src/main.tsx`.",
    "Keep the analysis prompt as a single constant string in `frontend/src/lib/analysisPrompt.ts` (do not remove or fragment it).",
    "Backend must remain single-actor; all logic stays in `backend/main.mo`."
  ],
  "nonGoals": [
    "Do not add third-party LLM/Gemini/OpenAI integrations or external API calls.",
    "Do not add new analysis output fields beyond `misconception` and `whyFailed`.",
    "Do not add new pages, accounts features, or unrelated UI polish beyond what’s needed to ensure correct analysis behavior."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}